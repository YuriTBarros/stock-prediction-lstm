graph TB
    subgraph "Data Layer"
        YF[Yahoo Finance API]
        LOCAL[Local Data<br/>SPY_data.parquet]
        POSTGRES[(PostgreSQL<br/>Metadata & Workflows)]
    end

    subgraph "MLOps Pipeline"
        N8N[n8n Workflow<br/>Orchestrator]
        API[FastAPI<br/>ML Service]
        MLFLOW[MLflow<br/>Experiment Tracking]
        DISCORD[Discord<br/>Notifications]
    end

    subgraph "ML Components"
        INGEST[Data Ingestion<br/>yfinance]
        PREPROC[Preprocessing<br/>MinMaxScaler]
        MODEL[LSTM Models<br/>Simple/Stacked/BiLSTM]
        TRAIN[Training Pipeline<br/>Grid Search]
    end

    subgraph "Storage"
        MODELS[Model Registry<br/>mlartifacts/]
        RUNS[Experiment Runs<br/>mlruns/]
        ARTIFACTS[Artifacts<br/>scalers, plots]
    end

    YF -->|Download| INGEST
    LOCAL -->|Fallback| INGEST
    INGEST -->|Raw Data| PREPROC
    PREPROC -->|Normalized| MODEL
    MODEL -->|Training| TRAIN
    TRAIN -->|Metrics| MLFLOW
    TRAIN -->|Save| MODELS
    
    N8N -->|Trigger| API
    API -->|Execute| TRAIN
    API -->|Log| MLFLOW
    API -->|Store| POSTGRES
    
    MLFLOW -->|Track| RUNS
    MLFLOW -->|Save| ARTIFACTS
    MLFLOW -->|Register| MODELS
    
    API -->|Notify| DISCORD
    N8N -->|Status| DISCORD
    
    POSTGRES -->|State| N8N
    POSTGRES -->|Metadata| MLFLOW

    style YF fill:#4285F4
    style LOCAL fill:#34A853
    style POSTGRES fill:#336791
    style N8N fill:#FF6D5A
    style API fill:#009688
    style MLFLOW fill:#0194E2
    style DISCORD fill:#5865F2
    style MODEL fill:#FF9800
    style TRAIN fill:#E91E63
    style MODELS fill:#9C27B0
